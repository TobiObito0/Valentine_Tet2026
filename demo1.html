<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo_Heart</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            font-family: Arial, Helvetica, sans-serif;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: red;
            border-radius: 50%;
            pointer-events: none
        }

        .text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-size: 48px;
            font-weight: bold;
            opacity: 0;
            text-align: center;
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <div id="text1" class="text">Yêu Công Chúa</div>
    <div id="text2" class="text">Happy New Year</div>

    <script>
        const TOTAL = 900;
        const particles = [];
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;

        for (let i = 0; i < TOTAL; i++) {
            const s = document.createElement("span");
            s.className = "particle";

            s.x = Math.random() * window.innerWidth;
            s.y = Math.random() * window.innerHeight;

            s.style.left = s.x + "px";
            s.style.top = s.y + "px";

            document.body.appendChild(s);
            particles.push(s);
        }

        function heartFunction(t) {
            const x = 16 * Math.pow(Math.sin(t), 3);
            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
            return { x, y };
        }

        const targets = [];
        for (let i = 0; i < TOTAL; i++) {
            const t = Math.random() * Math.PI * 2;
            const pos = heartFunction(t);

            targets.push({
                x: centerX + pos.x * 12,
                y: centerY - pos.y * 12
                });
        }

        function moveToTarget(speed = 1.2) {
            particles.forEach((p, i) => {
                const tx = targets[i].x;
                const ty = targets[i].y;

                p.x += (tx - p.x) * speed;
                p.y += (ty - p.y) * speed;

                p.style.left = p.x + "px";
                p.style.top = p.y + "px";
            });
        }

        let beatCount = 0;
        let scale = 1;
        let growing = true;

        function heartbeat() {
            if (beatCount > 3) {
                explode();
                return;
            }

            if (growing) scale += 0.02;
            else scale -= 0.02;

            if (scale >= 1.25) growing = false;
            if (scale <= 1) {
                growing = true;
                beatCount++;
            }

            particles.forEach((p,i)=>{
                const tx = targets[i].x;
                const ty = targets[i].y;

                p.style.left = centerX + (tx-centerX)*scale + "px";
                p.style.top = centerY + (ty-centerY)*scale + "px";
            });

            requestAnimationFrame(heartbeat);
        }

        function explode() {
            particles.forEach(p => {
                p.vx = Math.random()-0.5 * 10;
                p.vy = Math.random()-0.5 * 10;
            });

            function frame() {
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.style.left = p.x + "px";
                    p.style.top = p.y + "px";
                });
                requestAnimationFrame(frame);
            }
            frame();

            showText();
        }

        function showText() {
            const t1 = document.getElementById("text1");
            const t2 = document.getElementById("text2");

            setTimeout(()=>{
                t1.style.opacity = 1;

                setTimeout(()=>{
                    t1.style.opacity = 0;

                    setTimeout(()=>{
                        t2.style.opacity = 1;
                    },2000);
                                
                }, 2000);
            }, 500);
        }
                        
        let formTime = 0;
        function formHeart(){
            moveToTarget(0.07);
            formTime++;

            if (formTime < 120) {
                requestAnimationFrame(formHeart);
            }else{
                heartbeat();
            }
        }
        formHeart();
    </script>
</body>

</html>