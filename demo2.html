<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Công Chúa Của Anh</title>

<style>
    body{
        margin:0;
        overflow:hidden;
        background:black;
        font-family:Arial, Helvetica, sans-serif;
        touch-action:none;
    }

    /* Hạt bụi */
    .particle{
        position:absolute;
        width:4px;
        height:4px;
        background:red;
        border-radius:50%;
        pointer-events:none;
        will-change:transform,left,top;
    }

    /* Text */
    .text{
        position:absolute;
        top:50%;
        left:50%;
        transform:translate(-50%,-50%);
        color:red;
        font-weight:bold;
        opacity:0;
        transition:opacity 2s;
        text-align:center;
        white-space:nowrap;
        user-select:none;
    }

    /* Responsive chữ */
    #text1{ font-size: clamp(28px,6vw,52px); }
    #text2{ font-size: clamp(26px,5vw,46px); }

</style>
</head>

<body>

<div id="text1" class="text">Yêu Công Chúa</div>
<div id="text2" class="text">Happy New Year</div>

<script>
/* ====== NHẠC NỀN ====== */
const audio = new Audio();
audio.src = "music/music.mp3"; // ← thay link nhạc
audio.loop = true;
audio.volume = 0.7;

/* Autoplay mobile workaround */
document.addEventListener("click",()=>{
    audio.play().catch(()=>{});
},{once:true});

/* ====== RESPONSIVE ====== */
let W = window.innerWidth;
let H = window.innerHeight;

let centerX = W/2;
let centerY = H/2;

/* Giảm hạt trên mobile */
const isMobile = W < 768;
const TOTAL = isMobile ? 500 : 900;

const particles=[];
const targets=[];

/* ====== TẠO HẠT ====== */
for(let i=0;i<TOTAL;i++){
    const s=document.createElement("span");
    s.className="particle";

    s.x=Math.random()*W;
    s.y=Math.random()*H;

    s.style.left=s.x+"px";
    s.style.top =s.y+"px";

    document.body.appendChild(s);
    particles.push(s);
}

/* ====== PHƯƠNG TRÌNH TIM ====== */
function heartFunction(t){
    const x=16*Math.pow(Math.sin(t),3);
    const y=
        13*Math.cos(t)
        -5*Math.cos(2*t)
        -2*Math.cos(3*t)
        -Math.cos(4*t);
    return {x,y};
}

/* Target tim */
function createTargets(){
    targets.length=0;

    const scale = isMobile ? 9 : 12;

    for(let i=0;i<TOTAL;i++){
        const t=Math.random()*Math.PI*2;
        const pos=heartFunction(t);

        targets.push({
            x:centerX + pos.x*scale,
            y:centerY - pos.y*scale
        });
    }
}
createTargets();

/* ====== DI CHUYỂN ====== */
function moveToTargets(speed=0.06){
    particles.forEach((p,i)=>{
        const tx=targets[i].x;
        const ty=targets[i].y;

        p.x+=(tx-p.x)*speed;
        p.y+=(ty-p.y)*speed;

        p.style.left=p.x+"px";
        p.style.top =p.y+"px";
    });
}

/* ====== NHỊP ĐẬP ====== */
let beatCount=0;
let scaleBeat=1;
let growing=true;

function heartbeat(){

    if(beatCount>=3){
        explode();
        return;
    }

    if(growing) scaleBeat+=0.02;
    else scaleBeat-=0.02;

    if(scaleBeat>=1.25) growing=false;
    if(scaleBeat<=1){
        growing=true;
        beatCount++;
    }

    particles.forEach((p,i)=>{
        const tx=targets[i].x;
        const ty=targets[i].y;

        p.style.left=
            centerX+(tx-centerX)*scaleBeat+"px";
        p.style.top =
            centerY+(ty-centerY)*scaleBeat+"px";
    });

    requestAnimationFrame(heartbeat);
}

/* ====== NỔ ====== */
function explode(){

    particles.forEach(p=>{
        p.vx=(Math.random()-0.5)*12;
        p.vy=(Math.random()-0.5)*12;
    });

    function frame(){
        particles.forEach(p=>{
            p.x+=p.vx;
            p.y+=p.vy;
            p.style.left=p.x+"px";
            p.style.top =p.y+"px";
        });
        requestAnimationFrame(frame);
    }
    frame();

    showText();
}

/* ====== TEXT ====== */
function showText(){
    const t1=document.getElementById("text1");
    const t2=document.getElementById("text2");

    setTimeout(()=>{
        t1.style.opacity=1;

        setTimeout(()=>{
            t1.style.opacity=0;

            setTimeout(()=>{
                t2.style.opacity=1;
            },2000);

        },2000);

    },500);
}

/* ====== TIMELINE ====== */
let formTime=0;

function formHeart(){
    moveToTargets(0.07);
    formTime++;

    if(formTime<120){
        requestAnimationFrame(formHeart);
    }else{
        heartbeat();
    }
}
formHeart();

/* ====== RESIZE ====== */
window.addEventListener("resize",()=>{
    W=window.innerWidth;
    H=window.innerHeight;

    centerX=W/2;
    centerY=H/2;

    createTargets();
});
</script>

</body>
</html>